<!-- editor.handlebars -->
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta charset="utf-8">
  <meta name="description" content="FlyTED2 home page">
  <meta name="author" content="Benedict Uttley, Cardiff University, Biosciences">
  <title>Editor</title>

  <!--Load jquery-->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <!-- Load the Bootstrap js files -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"
    integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
    crossorigin="anonymous"></script>
  <script src="dropzone.js"></script>
  <!-- LOAD EXTERNAL JS SCRIPTS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="sidebar.js"></script>
  <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>


  <!-- CSS LINKS -->
  <link href="dropzone.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  <link rel="stylesheet" type="text/css" href="component.css" />
  <link rel="stylesheet" type="text/css" href="editor.css" />

  <!-- Config for file input CREDIT: By Osvaldas Valutis, www.osvaldas.info MIT liscence-->
  <script>
  (function(e, t, n) {
    var r = e.querySelectorAll("html")[0];
    r.className = r.className.replace(/(^|\s)no-js(\s|$)/, "$1js$2")
  })(document, window, 0);
  </script>
</head>

<body>
  <!--Side bar containing query bulder form -->
  <div id="mySidenav" class="sidenav">
    <div class="container">
      <a class="closebtn" onclick="closeNav()" style="color: white" onclick="toggleSide()">&times</a>
      <br>
      <form class="form-horizontal" method="post" action="/results">
        <h3 style="color:white">Query Builder</h3>
        <div class="form-group">
          <label class="control-label col-sm-2" style="color: white">GENE</label>
          <div class="col-sm-10">
            <input class="form-control" id="gene" name="Probe" placeholder="Enter gene(s)" data-toggle="tooltip"
              data-placement="left" title="Seperate multiple genes with commas.">
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" style="color: white">VARIANT</label>
          <div class="col-sm-10">
            <input class="form-control" id="variant" name="Variant" placeholder="Enter Variant(s)"
              data-toggle="tooltip" data-placement="left" title="Seperate multiple genotypes with commas.">
          </div>
        </div>
        <br>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-lg sharp" style="width:100%">EXECUTE</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!--Top sticky navigation bar -->
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary fixed-top" style="background-color: gray !important; border-bottom: 2px solid white">
    <button class="btn btn-info navbar-btn" onclick="toggleSide()">New Query</button>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
      aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="nav navbar-nav mr-auto">
        <li class="nav-item">
          <a style="color: white" class="nav-link">FlyTED2</a>
        </li>
      </ul>
      <ul class="nav navbar-nav">
        <li class="nav-item">
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/home">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/credits">Credits</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/cite">Liscence and Citing</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/cite">Admin</a>
          <span class="sr-only">(current)</span>
        </li>
      </ul>
    </div>
  </nav>

  <div id="content" class="content">

    <h1 style="color: #d4374a">WELCOME TO THE EDITOR</h1>
    <h2 style="color: #d4374a">Complete Dataset Upload</h2>

    {{#errors}}
      <ul class="errors">
        {{#error}}
          <li>{{.}}</li>
        {{/error}}
      </ul>
    {{/errors}}
    <br>
    <!-- Bulk image upload notification container -->
    <div style="width: 100%;float:left;" id="myDiv"></div>
    <!-- Bulk image upload container -->
    <div class="main_info" style="width: 100%; float:left;">
      <div class="main_info" style="width: 30%;float:right; height: 100%; padding:0">
        <form action="/fileupload" class="dropzone dz-clickable" method="post" id="my-awesome-dropzone"
          style="height:100%">
          <div class="fallback">
            <input name="file" type="file" multiple />
          </div>
          <div class="dz-message" data-dz-message>
            <span style="font-weight: bold">Click to select images or drag and drop a folder</span>
          </div>
        </form>
      </div>
      <h2 style="text-decoration: underline">Upload Expression Images</h2>
      <p>
        Submit new images here, the images should be bitmaps, having the (.bmp) extension.
        You can upload multiple images at once by dragging and dropping the folder
        into the right hand-side panel. Submitted images need must adhere to the
        following structure: [Gene]_[imageID]_[Date.bmp].
      </p>
      <h4>Acceptable image name examples:</h4>
      <ul>
        <li>CG3494_comr01_5.11.07.bmp</li>
        <li>betaTub85D_wt01_24.3.07.bmp</li>
        <li>CG2750_aly01_19.6.06.bmp</li>
      </ul>
      <p>
        This is required so that FlyTED can link the images with the other datasets associated
        with the repective gene, which become unified when the query result is displayed
        to the viewer.
      </p>
      <p>
        Note: The date part of the image address should correspond to the date the image
        was taken or aquired rather then the time of submission to FlyTED.
      </p>
    </div>
    <br>

    <!--Bulk image annotation upload notification container -->
    <div style="width: 100%;float:left;" id="myDivtwo"></div>
    <!-- Bulk image annotation upload container -->
    <div class="main_info" style="width: 100%; float:left;">
      <div class="main_info" style="width: 30%;float:right; height: 100%; padding:0">
        <form action="/excel_upload_image" class="dropzone dz-clickable" method="post" id="my-awesome-dropzone-two"
          style="height:100%">
          <div class="fallback">
            <input name="file" type="file" multiple />
          </div>
          <div class="dz-message" data-dz-message>
            <span style="font-weight: bold">Click to select image annotations or drag and drop a folder</span>
          </div>
        </form>
      </div>
      <h2 style="text-decoration: underline">Upoad Image Annotations</h2>
      <p>
        Submit new image annotation entries here, which are displayed alongside the respecitive
        image. Bulk descriptions can be uploaded by storing descriptions as rows
        in an excel spreadsheet, with the extension (.xls). In order for the spreasheet
        to be uploaded successfully, it must follow the expected schema. FlyTED will
        look for the following columns to display, and will ignore others, the colums
        must be named as described below:
      </p>

      <h4>Image annotation schema:</h4>
      <ol>
        <li><b>date</b> - The date the image was taken.</li>
        <li><b>file name</b> - The name of the image.</li>
        <li><b>slide name</b> - The name of the slide used for the image acquisition.</li>
        <li><b>user</b> - WILL BE REMOVED</li>
        <li><b>probe</b> - The name of the gene.</li>
        <li><b>probe concentration</b> - The concentration of the probe that used.</li>
        <li><b>genotype a</b> - Variant being used.</li>
        <li><b>genotype b</b> - Variant being used (may be void if not only one variant
          present).
        </li>
        <li><b>objective</b> - WILL BE REMOVED </li>
        <li><b>optivar</b> - Resolution of image.</li>
        <li><b>c-mount</b> - WILL BE REMOVED</li>
        <li><b>stages shown in picture</b> - Nature of image e.g) whole testes, 2 whole
          testes </li>
        <li><b>description of staining pattern<b> - What does the expression pattern indicate.</li>
        <li><b>comments<b> - Any additional information.</li>
        <li><b>x-coordinate</b> - WILL BE REMOVED</li>
        <li><b>y-coordinate</b> - WILL BE REMOVED</li>
      </ol>
    </div>
    <br>

    <!-- Bulk microarray upload notification container -->
    <div style="width: 100%;float:left" id="myDivthree"></div>
    <!-- Bulk microarray upload container -->
    <div class="main_info" style="width: 100%; float:left;">
      <div class="main_info" style="width: 30%;float:right; height: 100%; padding:0">
        <form action="/excel_upload_desc" class="dropzone dz-clickable" method="post" id="my-awesome-dropzone-three"
          style="height:100%">
          <div class="fallback">
            <input name="file" type="file" multiple />
          </div>
          <div class="dz-message" data-dz-message>
            <span style="font-weight: bold">Click to select microarray dataset or drag and drop a folder</span>
          </div>
        </form>
      </div>

      <h2 style="text-decoration: underline">Upload Microarray Data</h2>
      <p>
        Upload microarray datasets here, which are displayed in graphical form on the results
        page of a given query. They can be uploaded in bulk in an excel(xls) spreadsheet.
        FlyTED will look for the following columns (which must be named as such)
        and ignore others.
      </p>
      <h4>Micorarray data schema:</h4>
      <b>Gene Symbol</b>||<b>Probe Set ID</b>||<b>Transcript ID(Array Design)</b>||<b>Target Description</b>||<b>wt-tin</b>||<b>wt-mip40-excised</b>||<b>wt-white</b>||<b>aly5</b>||<b>comr</b>||
      <b>tomb</b>||<b>nht</b>||<b>Nxt1</b>||<b>mip40(sh2/bsc)</b>||<b>mip40(ey)</b>||<b>mip40(ey);bg4</b>||<b>wucRNAi</b>||<b>wucRNAi;aly</b>||<b>mip40(sh2), comr</b>||<b>mip40(ey);aly</b>||<b>aly1-27</b>||
      <b>aly1-18</b>||<b>aly1-18-btr</b>
    </div>
    <br>

    <!-- Bulk probe sequence upload notification container -->
    <div style="width: 100%;float:left;" id="myDivfour"></div>
    <div class="main_info" style="width: 100%; float:left;">
      <!-- Bulk probe sequence upload container -->
      <div class="main_info" style="width: 30%;float:right; height: 100%; padding:0">
        <form action="/excel_probe_data" class="dropzone dz-clickable" method="post" id="my-awesome-dropzone-four"
          style="height:100%">
          <div class="fallback">
            <input name="file" type="file" multiple />
          </div>
          <div class="dz-message" data-dz-message>
            <span style="font-weight: bold">Click to select probe sequence annotations or drag and drop a folder</span>
          </div>
        </form>
      </div>
      <h2 style="text-decoration: underline">Upload Probe Sequences</h2>
      <p>
        Location to upload the 3' and 5' probe sequences used for the corresponding gene.
        FlyTED will then perform <b>BLAST</b> sequence alignment between
        the probes and all exisitng transcripts for that gene (retrieved externally
        from FlyMine), and generate the resulting target sequence that the testes
        expression images are sourced from.
      </p>
      <p>
        Sequence pairs can be uploaded in bulk in a excel spreadheet (.xls) and must adhere
        to the following schema:
      </p>

      <ul>
        <li>3_GeneID|| Sequence</li>
        <li>5_GeneID|| Sequence</li>
      </ul>
      <p>The constant sequence used in all 5' probes and those used in all 3' probes
        can be left in the submitted probe sequences</p>
    </div>


    <!-- Collection of custom functions -->
    <script>

    // Toggle display of the image addition form:
    function displayAdditionContainer(id, type) {
      let tab = document.getElementById(id);
      let addition_container = document.getElementById(id.replace('_tab',''));
      let current_display = addition_container.style.display;

      if(type == 'toggle'){
        if (current_display == "block") {
          addition_container.style.display = "none";
          tab.innerHTML = tab.innerHTML.replace('(-)', '(+)');

        } else {
          addition_container.style.display = "block";
          tab.innerHTML = tab.innerHTML.replace('(+)', '(-)');
        }
      }

      if(type == true){
        addition_container.style.display = "block";
        tab.innerHTML = tab.innerHTML.replace('(+)', '(-)');
      }

      else if (type == false){
      addition_container.style.display = "none";
      tab.innerHTML = tab.innerHTML.replace('(-)', '(+)');

      }
    }

    // Delete image and it's metadata
    function delImgAndData(image_name) {
      $.ajax({
        type: 'post',
        url: '/removeImageAndData',
        data: {
          "image_name": image_name
        },
        success: function(response) {
          console.log("DELETE IS DONE!"); // Add confirm and confirmation
        }
      });
    }
    </script>

    <h1>NAVBAR WOULD GO HERE</h1>
    <button class="tablink" onclick="openPage('Home', this, 'red')">Home</button>
    <button class="tablink" onclick="openPage('News', this, 'green')" id="defaultOpen">News</button>

    <div id="Home" class="tabcontent">
      <h3>Home</h3>
      <p>Home is where the heart is..</p>
    </div>

    <div id="News" class="tabcontent">
      <h3>News</h3>
      <p>Some news this fine day!</p>
    </div>

    <script>
    function openPage(pageName,elmnt,color) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].style.backgroundColor = "";
        }
        document.getElementById(pageName).style.display = "block";
        elmnt.style.backgroundColor = color;

    }
    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();
    </script>
  </body>

  <script type="text/javascript" src="formListeners.js"></script>
  <script type="text/javascript" src="dropzoneConfigurations.js"></script>

</html>
